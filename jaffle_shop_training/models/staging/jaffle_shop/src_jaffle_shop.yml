sources:
  - name: jaffle_shop
    # project: sql-training-422508 # Not required since it's in the same project
    dataset: data_warehousing # Can also call it schema
    description: This is store-based data
    # table_prefix: raw_ 
    tables:
      - name: customers
        identifier: raw_customers
        description: A list of customers regardless of whether or not they have made any orders.
        columns:
          - name: id
            description: ID column unique to each customer
            data_type: int64
            data_tests:
              - unique
              - not_null
          - name: first_name
            description: A first name. 
            data_type: string
          - name: last_name
            description: Despite the name this is actually a last initial.
            data_type: string

      - name: orders
        identifier: raw_orders
        columns:
          - name: id
            data_type: int64
          - name: user_id
            data_type: int64
            data_tests:
              - relationships:
                  to: ref('stg_jaffle_shop_customers')
                  field: customer_id
          - name: order_date
            data_type: date
          - name: status
            description: "{{ doc('order_status') }}"
            data_type: string
            data_tests:
              - accepted_values:
                  values:
                    - placed
                    - shipped
                    - returned
                    - completed
                    - return_pending

      - name: payments
        identifier: raw_payments
        freshness:
          warn_after:
            count: 30
            period: day
          error_after:
            count: 400
            period: day
        columns:
          - name: id
            data_type: int64
            data_tests:
              - unique
              - not_null
          - name: orderid
            data_type: int64
            data_tests:
              - relationships:
                  to: ref('stg_jaffle_shop_orders')
                  field: order_id
          - name: paymentmethod
            data_type: string
            data_tests:
              - accepted_values:
                  values:
                    - coupon
                    - gift_card
                    - credit_card
                    - bank_transfer
          - name: amount
            data_type: int64
            data_tests:
              - dbt_utils.accepted_range:
                  min_value: 0
                  inclusive: true